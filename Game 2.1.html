<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Marc's Pong</title>
    <style>
        * { padding: 0; margin: 0; }
        canvas { background: #ffffff; display: block; margin: 0 auto; }
    </style>
    <h1>Press ENTER to start and restart</h1>
</head>
<body>
<canvas id="myCanvas" width="1000" height="640"></canvas>
<div id="counter1"></div>
<div id="counter2"></div>

<script>
    var canvas = document.getElementById("myCanvas"); //
    var ctx = canvas.getContext("2d");

    //Counter

    var counterP1 = 0;
    var counterP2 = 0;
    var winner;

    // Ball

    var interval;
    var ballDirectionX;
    var ballDirectionY;
    var x;
    var y;
    var ball = false;

    var ballRadius = 15;

    // Paddle
    var lengthPaddle = 150;
    var widthPaddle = 15;
    var paddle_pos1 = canvas.height/2-lengthPaddle/2; //that's where the paddle appears
    var paddle_pos2 = canvas.height/2-lengthPaddle/2;
    const spaceBPaddle1 = 0;//space between the paddle of player one and the wall
    const spaceBPaddle2 = canvas.width - widthPaddle;//space between the paddle of player two and the wall

    var keyDown = false;
    var keyUp = false;
    var keyW = false;
    var keyS = false;

    // ----- paint

    function drawBall()
    {
        ball = true;
        ctx.beginPath();
        ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
        ctx.fillStyle = "#268ddd";
        ctx.fill();
        ctx.closePath();
    }
    function drawPaddle1()
    {
        ctx.beginPath();
        ctx.rect(spaceBPaddle1,paddle_pos1,widthPaddle,lengthPaddle);
        ctx.fillStyle = "#0038ff";
        ctx.fill();
        ctx.closePath();
    }
    function drawPaddle2()
    {
        ctx.beginPath();
        ctx.rect(spaceBPaddle2,paddle_pos2,widthPaddle,lengthPaddle);
        ctx.fillStyle = "#0038ff";
        ctx.fill();
        ctx.closePath();
    }

    function draw()
    {
        if(counterP1 <= 5 || counterP2 <= 5) {
            clearCanvas();

            drawBall();
            drawPaddle1();
            drawPaddle2();


            moveBall();
            movePaddle1();
            checkDraw();
            movePaddle2();
        }
    }

    //it deletes all what was printed (drawed)
    function clearCanvas()
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }


    // --------- LOGIC / Business


    function moveBall(){

        y = y+ballDirectionY;
        x = x+ballDirectionX;
    }
    function movePaddle1() {

        if (keyDown)
        {

            paddle_pos1 += 7;

        }
        else if(keyUp) {

            paddle_pos1 -= 7;
        }
    }
    function movePaddle2()
    {
       if (keyW)
       {
            paddle_pos2 += 7;
       }
       else if(keyS){
           paddle_pos2 -= 7;
       }
    }

    function checkDraw()
    {
        // (+) check if paddle is there


        // if arrives to the right limit
        //
        if (x + ballDirectionX > canvas.width)
        {
            ballDirectionX = -ballDirectionX;
        }
        // if arrives to the top limit
        //
        else if(y + ballDirectionY > canvas.height)
        {
            ballDirectionY = -ballDirectionY;
        }
        // if arrives to the bottom limit
        //
        else if (y + ballDirectionY <= 0) {
            ballDirectionY = -ballDirectionY;
        }
        // if arrives to the left limit
        //
        else if(x + ballDirectionX <= 0) {
            counterP2 = ++counterP2;
            clearInterval(interval); // remove the iteration
        }
        else if(
            spaceBPaddle1 < x
            && x < (spaceBPaddle1 + widthPaddle  + 2)
            && paddle_pos1 < y
            && y < (paddle_pos1 + lengthPaddle))
        {
            ballDirectionX = -ballDirectionX;
        }

    }
    function counters()
    {
        if(counterP1 >= 5|| counterP2 >= 5){
            clearCanvas();
            counterP1 = 0;
            counterP2 = 0;
            ctx.beginPath();
            ctx.font = '124px serif';
            ctx.strokeText('Game Over',canvas.width/6 , canvas.height/10);
            ctx.closePath();
            ctx.font = "34px serif";
            ctx.strokeText("press ENTER to start",canvas.width/3,canvas.height/4);
            keyDownHandler();
        }
        document.getElementById('counter1').innerText = "Player1:" + counterP1;
        document.getElementById('counter2').innerText = "Player2:" + counterP2;

    }
    // ---------------- Keyboard Listeners

    document.addEventListener("keydown", keyUpHandler, false);
    document.addEventListener("keyup", keyDownHandler, false);
    document.addEventListener("KeyS", keyUpHandler,false);
    document.addEventListener("KeyW", keyDownHandler,false);

    function keyUpHandler(e)
    {
        if(e.key === 'ArrowDown')
        {
            keyDown = true;
        }
        else if(e.key === "ArrowUp")
        {
            keyUp = true;
        }
        else if(e.key === 'KeyW')
        {
            keyW = true;
        }
        else if(e.key === 'KeyS')
        {
            keyS = true;
        }
    }

    function keyDownHandler(e)
    {
        if(e.key === 'ArrowDown')
        {
            keyDown = false;
        }
        else if(e.key === 'ArrowUp')
        {
            keyUp = false;
        }
        else if(e.key === 'KeyW')
        {
            keyW = false;
        }
        else if(e.key === 'KeyS')
        {
            keyS = false;
        }
        else if(ball === false)
        {
            startPath();
        }

        else if (e.key === 'Enter')
        {
                initialize();
        }
    }

    function startPath()
    {
        clearCanvas();
        ball = true;
        ctx.beginPath();
        ctx.font = "124px serif";
        ctx.textBaseline = "hanging";
        ctx.strokeText("Marc's Pong", canvas.width/6, canvas.height /10);
        ctx.font = "34px serif";
        ctx.strokeText("press ENTER to start",canvas.width/3,canvas.height/4);
        ctx.closePath();
    }

    // -----------------------


    //  Returns a random number between min (inclusive) and max (exclusive)

    function getRandomArbitrary(min, max)
    {
        return Math.random() * (max - min) + min;
    }

    function initialize()
    {
        ballDirectionX = -(getRandomArbitrary(2,6));//it's in which direction the ball moves
        ballDirectionY = -(getRandomArbitrary(2,6));
        x = canvas.width/2 + getRandomArbitrary(-50,50);// it's where the ball appears
        y = canvas.height/2 + getRandomArbitrary(-50,50);
        counters();
        interval = setInterval(draw,12); // initialize the game
    }




</script>

</body>
</html>